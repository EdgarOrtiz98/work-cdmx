package gob.hacienda.cgtic.siga.util;import com.meve.sigma.actualiza.ActualizaUsuario;import com.meve.sigma.db2.ConexionDS;import gob.hacienda.cgtic.siga.actualiza.AtenderInstrucciones;public class Jefe{        public static String[][] getRamaAtencion(String idUsuario){        String sql="SELECT SD_USUARIO.ID_USUARIO, SD_USUARIO.USU_ASISTENTE FROM SD_USUARIO, SD_AREA WHERE SD_USUARIO.USU_AREA=SD_AREA.ID_AREA AND SD_AREA.ID_AREA=(SELECT USU_AREA FROM SD_USUARIO WHERE ID_USUARIO="+idUsuario+") AND  (SD_USUARIO.USU_ASISTENTE="+idUsuario+" OR SD_AREA.ARE_SUPERVISOR="+idUsuario+")";        String sqlTitular="SELECT ID_USUARIO, USU_CARGO, USU_NOMBRE FROM SD_USUARIO WHERE USU_ESTATUS=1 AND USU_ACTIVO=1 AND USU_AREA=(SELECT USU_AREA FROM SD_USUARIO WHERE ID_USUARIO="+idUsuario+") ORDER BY USU_JEFE ASC";        String sqlSubordinado="SELECT ID_USUARIO, USU_CARGO, USU_NOMBRE FROM SD_USUARIO WHERE USU_ESTATUS=1 AND USU_ACTIVO = 1 START WITH USU_JEFE=(SELECT ID_USUARIO FROM SD_USUARIO WHERE ID_USUARIO="+idUsuario+" OR USU_ASISTENTE="+idUsuario+") CONNECT BY PRIOR ID_USUARIO=USU_JEFE ORDER BY USU_JEFE";                String[][] string=null;                try{            string=ConexionDS.ejecutarSQL(sql);            if(string[0][0].equals(idUsuario)||string[0][1].equals(idUsuario))                string = ConexionDS.ejecutarSQL(sqlTitular);            else                string = ConexionDS.ejecutarSQL(sqlSubordinado);        }catch(Exception e){            //System.out.println("Error al obtener la jerarquia del usuario... "+e.getMessage());            e.printStackTrace();        }        return string;    }        /**     * Método que investiga si un usuario puede tener los permisos suficientes para poder reasignar una instrucción rechazada por un      * subordinado.     * Se consulta todos los usuarios que son superiores a el, y si en alguno de ellos, el usuari que se autentifica, corresponde a los     * encontrados, regresa un true, en otro caso, regresa un false.     *      * @param idAsigno  Identificador del usuario que rechazo la instrucción.     * @param idUsuario Identificador del usuario que es logeado.     * @return  true, si el usuario es el jefe del usuario que rechazo la instrucción, false otro caso.     */        public static boolean esJefeDe(String idAsigno,String idUsuario){        String[][] superiores=null;        String[][] asustentesSuperiores=null;        //Obtiene todos los superiores...        String[][] idRol = null;        String sqlRol = "SELECT ID_ROL FROM SD_USUARIO INNER JOIN SD_USUARIO_ROL ON ID_USUARIO = ID_USUARIO1 WHERE ID_USUARIO = "+idUsuario;        String sqlAtencion = "SELECT DISTINCT ID_USUARIO FROM SD_USUARIO WHERE USU_ESTATUS = 1 AND USU_ACTIVO = 1 START WITH ID_USUARIO = "+idAsigno+" CONNECT BY PRIOR USU_JEFE = ID_USUARIO";        String sqlAsistente = "SELECT DISTINCT ASI_USUARIO FROM SD_ASISTENTES WHERE ASI_ASISTENTE ="+idUsuario;                boolean resultado=false;        try{/*            superiores = ConexionDS.ejecutarSQL(sql);            //Si la persona que se logea, es el superior de la persona que Rechazó la instrucción, este obtendrá el privilegio de reasignar la instrucción...            for(int indice=0;indice<superiores.length;indice++){                if(superiores[indice][0].equals(idUsuario))                    resultado = true;            }*/            idRol = ConexionDS.ejecutarSQL(sqlRol);            for(int indice=0;indice<idRol.length;indice++){                switch(Integer.parseInt(idRol[indice][0])){                    case 1:                    //Usuario con rol de atención                     superiores = ConexionDS.ejecutarSQL(sqlAtencion);                    for(int iUsuario = 0; iUsuario<superiores.length;iUsuario++){                        if(superiores[iUsuario][0].equals(idAsigno))                            return true;                    }                    break;                    case 6:                    //Usuario con rol de asistente                    superiores = ConexionDS.ejecutarSQL(sqlAtencion);                                        asustentesSuperiores=ConexionDS.ejecutarSQL(sqlAsistente);                    for(int isuperior = 0; isuperior < superiores.length;isuperior++){                        for( int iasistente=0;iasistente< asustentesSuperiores.length;iasistente++)                            if(superiores[isuperior][0].equals(asustentesSuperiores[iasistente][0]))                            return true;                    }                    break;                    case 5:                    break;                    default:                    break;                }                            }        }catch(Exception e){            resultado = false;            //System.out.println("Error al obtener a los superiores de dicho usuario: ");            e.printStackTrace();        }        return resultado;    }        public static boolean esAsistenteDe(String idAsistente,String idUsuario){        String sql = "SELECT ASI_USUARIO FROM SD_ASISTENTES WHERE ASI_ASISTENTE="+idAsistente;        String idJefes = "";        String[][] resultado=null;        boolean boleano = false;        try{            resultado=ConexionDS.ejecutarSQL(sql);            if(resultado[0][0].length()>0){                for(int indice=0;indice<resultado.length;indice++){                    if(idUsuario.equals(resultado[indice][0].trim()))                        return true;                }                for(int indice=0;indice<resultado.length-1;indice++){                    idJefes+=resultado[0][0]+",";                }                idJefes+=resultado[resultado.length-1][0];                sql = "SELECT ID_USUARIO FROM SD_USUARIO WHERE USU_ACTIVO = 1 AND USU_ESTATUS = 1 START WITH USU_JEFE IN ("+idJefes+") CONNECT BY PRIOR ID_USUARIO = USU_JEFE";                resultado=ConexionDS.ejecutarSQL(sql);                for( int indice = 0 ; indice<resultado.length ; indice++ ){                    if(idUsuario.equals(resultado[indice][0].trim()))                        return true;                }            }        }catch(Exception e){boleano = false;}        return boleano;    }        /*Metodo incrementado el Día 12 de febrero de 2008*/    public static String getAtencion(String idAsistente){        String sql = "SELECT ASI_USUARIO FROM SD_ASISTENTES WHERE ASI_ASISTENTE ="+idAsistente;        String resultado = null;        //System.out.println("getAtencion: "+sql);        try{            resultado = ConexionDS.ejecutarSQL(sql)[0][0];            resultado=resultado!=null?resultado:idAsistente;        }catch(Exception e){            resultado=resultado!=null?resultado:idAsistente;        }        return resultado;    }    }