/*
 * Created on 30/10/2005
 *
 * TODO To change the template for this generated file go to
 * Window - Preferences - Java - Code Style - Code Templates
 */
package com.meve.sigma.beans;

import java.text.SimpleDateFormat;
import java.util.Date;

import javax.servlet.http.HttpServletRequest;

import com.meve.sigma.actualiza.ActualizaArea;
import com.meve.sigma.actualiza.ActualizaAsunto;
import com.meve.sigma.actualiza.ActualizaBitacora;
import com.meve.sigma.actualiza.ActualizaFlujo;
import com.meve.sigma.actualiza.ActualizaFolio;
import com.meve.sigma.actualiza.ActualizaInstrucciones;
import com.meve.sigma.actualiza.ActualizaTipo_Doc;
import com.meve.sigma.actualiza.ActualizaUsuario;
import com.meve.sigma.util.GeneracionFolio;
import com.meve.sigma.util.SenderMail;

/**
 * AsuntoBean es un bean que contiene los datos de un asunto al procesarse
 * 
 * @author Meve Soluciones SA de CV
 */
public class AsuntoBean {

	/**
	 * Entidad
	 */
	String asuntoEntidad;
	
	/**
	 * Id entidad
	 */
	String idEntidad;
	
	/**
	 * Otra entidad
	 */
	String asuntoEntidadOtro;
	
	/**
	 * Otro remitente
	 */
	String asuntoRemitenteOtro;
	
	/**
	 * Id remitente
	 */
	String idRemitente;
	
	/**
	 * remitente
	 */
	String asuntoRemitente;
	
	/**
	 * Nombre Usuario
	 */
	String asuntoCargo;
	
	/**
	 * Mail usuario
	 */
	String asuntoCorreo;
	
	/**
	 * Firmante
	 */
	String asuntoFirmante;
	
	/**
	 * Id destinatario
	 */
	String idDestinatario;
	
	/**
	 * Otro expediente
	 */
	String asuntoExpedienteOtro;
	
	/**
	 * Ubicación
	 */
	String asuntoUbicacion;
	
	/**
	 * Referencia
	 */
	String asuntoReferencia;
	
	/**
	 * Otro tipo de docto.
	 */
	String asuntoTipoDoctoOtro;
	
	/**
	 * Categoria asunto
	 */
	String asuntoCategoriaDocto;
	
	/**
	 * Agregar1
	 */
	String agregar1;
	
	/**
	 * Ventanilla
	 */
	String asuntoDestinatario;
	
	/**
	 * Cargo ventanilla
	 */
	String asuntoCargoDest;
	
	/**
	 * área ventanilla
	 */
	String asuntoAreaDest;
	
	/**
	 * Mail ventanilla
	 */
	String mailDest;
	
	/**
	 * Nombre asunto
	 */
	String asunto;
	
	/**
	 * Expediente
	 */
	String asuntoExpediente;
	
	/**
	 * Tipo de documento
	 */
	String asuntoTipoDocto;
	
	/**
	 * Fecha Recepción
	 */
	String asuntoFechaRecepcion;
	
	/**
	 * Fecha Documento
	 */
	String asuntoFechaDocto;
	
	/**
	 * Fecha compromiso
	 */
	String asuntoFechaCad;
	
	/**
	 * Identificador del docto.
	 */
	String asuntoFolioExt;
	
	/**
	 * Folio intermedio
	 */
	String asuntoFolioInt;
	
	/**
	 * Descripción
	 */
	String asuntoSintesis;
	
	/**
	 * Comentarios
	 */
	String asuntoComentario;
	
	/**
	 * Palabra clave
	 */
	String asuntoPalabraClave;
	
	/**
	 * Asunto Anterior
	 */
	String asuntoAnterior;
	
	/**
	 * Prioridad
	 */
	String asuntoPrioridad;
	
	/**
	 * Tipo asunto
	 */
	String asuntoTipoAsunto;
	
	/**
	 * Ruta automatica
	 */
	String asuntoRutaAuto;
	
	/**
	 * acción
	 */
	String accion;
	
	/**
	 * Id asunto
	 */
	String id_asunto;
	
	/**
	 * Control
	 */
	String control;
	
	/**
	 * Url
	 */
	String url;
	
	/**
	 * Folio
	 */
	String fol;
	
	/**
	 * Tipo de documento
	 */
	String asuntoTipoDocto_1;
	
	/**
	 * Pro
	 */
	String pro;
	
	/**
	 * Tipo asunto
	 */
	String tipoAsu;
	
	public AsuntoBean(){}
	
	
	/**
	 * 
	 * @param pro
	 */
	public void setPro(String pro){
	    this.pro = pro;
	}
	
	public String getPro(){
		return this.pro;
	}
	
	/**
	 * 
	 * @param tipoAsu
	 */
	public void setTipoAsu(String tipoAsu){
	    this.tipoAsu = tipoAsu;
	}
	
	public String getTipoAsu(){
		return this.tipoAsu;
	}
	
	/**
	 * 
	 * @param asuntoTipoDocto_1
	 */
	public void setAsuntoTipoDocto_1(String asuntoTipoDocto_1){
	    this.asuntoTipoDocto_1 = asuntoTipoDocto_1;
	}
	
	public String getAsuntoTipoDocto_1(){
		return this.asuntoTipoDocto_1;
	}
	
	/**
	 * 
	 * @param fol
	 */
	public void setFol(String fol){
	    this.fol = fol;
	}
	
	public String getFol(){
		return this.fol;
	}
	
	/**
	 * 
	 * @param id_asunto
	 */
	public void setId_asunto(String id_asunto){
	    this.id_asunto = id_asunto;
	}
	
	public String getId_asunto (){
		return this.id_asunto;
	}
	/**
	 * 
	 * @param idEntidad
	 */
	public void setIdEntidad(String idEntidad){
	    this.idEntidad = idEntidad;
	}
	
	public String getIdEntidad (){
		return this.idEntidad;
	}
	
	/**
	 * 
	 * @param asuntoEntidad
	 */
	public void setAsuntoEntidad (String asuntoEntidad) {
		this.asuntoEntidad = asuntoEntidad;		
	}
	
	public String getAsuntoEntidad (){
		return this.asuntoEntidad;
	}
	
	/**
	 * 
	 * @param asuntoEntidadOtro
	 */
	public void setAsuntoEntidadOtro(String asuntoEntidadOtro) {
		this.asuntoEntidadOtro = asuntoEntidadOtro;		
	}
	
	public String getAsuntoEntidadOtro(){
		return this.asuntoEntidadOtro;
	}
	
	/**
	 * 
	 * @param idRemitente
	 */
	public void setIdRemitente(String idRemitente) {
		this.idRemitente = idRemitente;		
	}
	
	public String getIdRemitente(){
		return this.idRemitente;
	}
	
	/**
	 * 
	 * @param asuntoRemitente
	 */
	public void setAsuntoRemitente(String asuntoRemitente) {
		this.asuntoRemitente = asuntoRemitente;		
	}
	
	public String getAsuntoRemitente(){
		return this.asuntoRemitente;
	}
	
	/**
	 * 
	 * @param asuntoRemitenteOtro
	 */
	public void setAsuntoRemitenteOtro(String asuntoRemitenteOtro) {
		this.asuntoRemitenteOtro = asuntoRemitenteOtro;		
	}
	
	public String getAsuntoRemitenteOtro(){
		return this.asuntoRemitenteOtro;
	}
	
	/**
	 * 
	 * @param asuntoCargo
	 */
	public void setAsuntoCargo(String asuntoCargo) {
		this.asuntoCargo = asuntoCargo;		
	}
	
	public String getAsuntoCargo(){
		return this.asuntoCargo;
	}
	
	/**
	 * 
	 * @param asuntoCorreo
	 */
	public void setAsuntoCorreo(String asuntoCorreo) {
		this.asuntoCorreo = asuntoCorreo;		
	}
	
	public String getAsuntoCorreo(){
		return this.asuntoCorreo;
	}
	
	/**
	 * 
	 * @param asuntoFirmante
	 */
	public void setAsuntoFirmante(String asuntoFirmante) {
		this.asuntoFirmante = asuntoFirmante;		
	}
	
	public String getAsuntoFirmante(){
		return this.asuntoFirmante;
	}
	
	/**
	 * 
	 * @param idDestinatario
	 */
	public void setIdDestinatario(String idDestinatario) {
		this.idDestinatario = idDestinatario;		
	}
	
	public String getIdDestinatario(){
		return this.idDestinatario;
	}
	
	/**
	 * 
	 * @param asuntoDestinatario
	 */
	public void setAsuntoDestinatario(String asuntoDestinatario) {
		this.asuntoDestinatario = asuntoDestinatario;		
	}
	
	public String getAsuntoDestinatario(){
		return this.asuntoDestinatario;
	}
	
	/**
	 * 
	 * @param asuntoCargoDest
	 */
	public void setAsuntoCargoDest(String asuntoCargoDest) {
		this.asuntoCargoDest = asuntoCargoDest;		
	}
	
	public String getAsuntoCargoDest(){
		return this.asuntoCargoDest;
	}
	
	/**
	 * 
	 * @param asuntoAreaDest
	 */
	public void setAsuntoAreaDest(String asuntoAreaDest) {
		this.asuntoAreaDest = asuntoAreaDest;		
	}
	
	public String getAsuntoAreaDest(){
		return this.asuntoAreaDest;
	}
	
	/**
	 * 
	 * @param mailDest
	 */
	public void setMailDest(String mailDest) {
		this.mailDest = mailDest;		
	}
	
	public String getMailDest(){
		return this.mailDest;
	}
	
	/**
	 * 
	 * @param asunto
	 */
	public void setAsunto(String asunto) {
		this.asunto = asunto;		
	}
	
	public String getAsunto(){
		return this.asunto;
	}
	
	/**
	 * 
	 * @param asuntoExpediente
	 */
	public void setAsuntoExpediente(String asuntoExpediente) {
		this.asuntoExpediente = asuntoExpediente;		
	}
	
	public String getAsuntoExpediente(){
		return this.asuntoExpediente;
	}
	
	/**
	 * 
	 * @param asuntoExpedienteOtro
	 */
	public void setAsuntoExpedienteOtro(String asuntoExpedienteOtro) {
		this.asuntoExpedienteOtro = asuntoExpedienteOtro;		
	}
	
	public String getAsuntoExpedienteOtro(){
		return this.asuntoExpedienteOtro;
	}
	
	/**
	 * 
	 * @param asuntoUbicacion
	 */
	public void setAsuntoUbicacion(String asuntoUbicacion) {
		this.asuntoUbicacion = asuntoUbicacion;		
	}
	
	public String getAsuntoUbicacion(){
		return this.asuntoUbicacion;
	}
	
	/**
	 * 
	 * @param asuntoReferencia
	 */
	public void setAsuntoReferencia(String asuntoReferencia) {
		this.asuntoReferencia = asuntoReferencia;		
	}
	
	public String getAsuntoReferencia(){
		return this.asuntoReferencia;
	}
	
	/**
	 * 
	 * @param asuntoTipoDocto
	 */
	public void setAsuntoTipoDocto(String asuntoTipoDocto) {
		this.asuntoTipoDocto = asuntoTipoDocto;		
	}
	
	public String getAsuntoTipoDocto(){
		return this.asuntoTipoDocto;
	}
	
	/**
	 * 
	 * @param asuntoTipoDoctoOtro
	 */
	public void setAsuntoTipoDoctoOtro(String asuntoTipoDoctoOtro) {
		this.asuntoTipoDoctoOtro = asuntoTipoDoctoOtro;		
	}
	
	public String getAsuntoTipoDoctoOtro(){
		return this.asuntoTipoDoctoOtro;
	}
	
	/**
	 * 
	 * @param asuntoCategoriaDocto
	 */
	public void setAsuntoCategoriaDocto(String asuntoCategoriaDocto) {
		this.asuntoCategoriaDocto = asuntoCategoriaDocto;		
	}
	
	public String getAsuntoCategoriaDocto(){
		return this.asuntoCategoriaDocto;
	}
	
	/**
	 * 
	 * @param asuntoFechaRecepcion
	 */
	public void setAsuntoFechaRecepcion(String asuntoFechaRecepcion) {
		this.asuntoFechaRecepcion = asuntoFechaRecepcion;		
	}
	
	public String getAsuntoFechaRecepcion(){
		return this.asuntoFechaRecepcion;
	}
	
	/**
	 * 
	 * @param asuntoFechaDocto
	 */
	public void setAsuntoFechaDocto(String asuntoFechaDocto) {
		this.asuntoFechaDocto = asuntoFechaDocto;		
	}
	
	public String getAsuntoFechaDocto(){
		return this.asuntoFechaDocto;
	}
	
	/**
	 * 
	 * @param asuntoFechaCad
	 */
	public void setAsuntoFechaCad(String asuntoFechaCad) {
		this.asuntoFechaCad = asuntoFechaCad;		
	}
	
	public String getAsuntoFechaCad(){
		return this.asuntoFechaCad;
	}
	
	/**
	 * 
	 * @param asuntoFolioExt
	 */
	public void setAsuntoFolioExt(String asuntoFolioExt) {
		this.asuntoFolioExt = asuntoFolioExt;		
	}
	
	public String getAsuntoFolioExt(){
		return this.asuntoFolioExt;
	}
	
	/**
	 * 
	 * @param asuntoFolioInt
	 */
	public void setAsuntoFolioInt(String asuntoFolioInt) {
		this.asuntoFolioInt = asuntoFolioInt;		
	}
	
	public String getAsuntoFolioInt(){
		return this.asuntoFolioInt;
	}
	
	/**
	 * 
	 * @param asuntoSintesis
	 */
	public void setAsuntoSintesis(String asuntoSintesis) {
		this.asuntoSintesis = asuntoSintesis;		
	}
	
	public String getAsuntoSintesis(){
		return this.asuntoSintesis;
	}
	
	/**
	 * 
	 * @param asuntoComentario
	 */
	public void setAsuntoComentario(String asuntoComentario) {
		this.asuntoComentario = asuntoComentario;		
	}
	
	public String getAsuntoComentario(){
		return this.asuntoComentario;
	}
	
	/**
	 * 
	 * @param asuntoPalabraClave
	 */
	public void setAsuntoPalabraClave(String asuntoPalabraClave) {
		this.asuntoPalabraClave = asuntoPalabraClave;		
	}
	
	public String getAsuntoPalabraClave(){
		return this.asuntoPalabraClave;
	}
	
	/**
	 * 
	 * @param asuntoAnterior
	 */
	public void setAsuntoAnterior(String asuntoAnterior) {
		this.asuntoAnterior = asuntoAnterior;		
	}
	
	public String getAsuntoAnterior(){
		return this.asuntoAnterior;
	}
	
	/**
	 * 
	 * @param asuntoPrioridad
	 */
	public void setAsuntoPrioridad(String asuntoPrioridad) {
		this.asuntoPrioridad = asuntoPrioridad;
	}
	
	public String getAsuntoPrioridad(){
		return this.asuntoPrioridad;
	}
	
	/**
	 * 
	 * @param asuntoTipoAsunto
	 */
	public void setAsuntoTipoAsunto(String asuntoTipoAsunto) {
		this.asuntoTipoAsunto = asuntoTipoAsunto;		
	}
	
	public String getAsuntoTipoAsunto(){
		return this.asuntoTipoAsunto;
	}
	
	/**
	 * 
	 * @param asuntoRutaAuto
	 */
	public void setAsuntoRutaAuto(String asuntoRutaAuto) {
		this.asuntoRutaAuto = asuntoRutaAuto;
	}
	
	public String getAsuntoRutaAuto(){
		return this.asuntoRutaAuto;
	}
	
	/**
	 * 
	 * @param control
	 */
	public void setControl(String control){
	    this.control = control;
	}
	
	public String getControl(){
	    return this.control;
	}
	
	/**
	 * 
	 * @param agregar1
	 */
	public void setAgregar1(String agregar1){
	    this.agregar1 = agregar1;
	}
	
	public String getAgregar1(){
	    return this.agregar1;
	}
	
	/**
	 * 
	 * @param accion
	 */
	public void setAccion(String accion){
	    this.accion = accion;
	}
	
	public String getAccion(){
	    return this.accion;
	}
	
	public void setUrl(String url){
	    this.url = url;
	}
	
	public String getUrl(){
	    return this.url;
	}
	
	
	public synchronized String guardarAsunto(String strIdEntidad, String strIdRemitente,
	        					String strFirmante, String strAsunto,
	        					String strIdExpediente, String strUbicacion,
	        					String strReferenciaExp, String strIdTipoDocto,
	        					String strCategoriaDocto, String strFechaRecepcion, String strFechaDocto,
	        					String strFechaCaducidad, String strFolioExterno, String strFolioIntermedio,
	        					String strSintesis, String strComentarios, String strPalabraClave,
	        					String strAsuntoAnterior, String strIdPrioridad, String strIdTipoAsunto,
	        					String strIdDestinatario, String strIdRuta, String strDestinatario,
	        					String strMailDest, String strRemitente, String strCorreo,
	        					String strAreaUs, String strIdUsrCaptura, String strControl, 
	        					boolean nuevoAsunto, String SMail, String SPort, String SN, String strRutaBase,
	        					String strConfFolio, String strEstatus,HttpServletRequest request){
	    
	    boolean bExisteFol 		= 	false;
	    boolean bUpdateConse 	= 	false;
	    boolean bInsertarBit	=	false;
	    boolean bInsertar		=	false;
	    
	    String claveFolio 		= 	"";
	    String consecutivo		= 	"";
	    String tipoDocto 		=	"";
	    String orden 			= 	"";
	    String idFolio 			= 	"";
	    String strFolioGenerado = 	"";
	    String strFechaCreacion	=	"";
	    
	    SimpleDateFormat sdf 	=	new SimpleDateFormat("dd/MM/yyyy");
		Date f 					=	new Date();
		strFechaCreacion 		=	sdf.format(f);
		if(!strIdTipoDocto.equals("null")){
		
		    String strDatosTD[][] 		=	ActualizaTipo_Doc.getTipoDoctoFolio(strIdTipoDocto);
		    
		    if(strDatosTD==null || strDatosTD.length<1 || strDatosTD[0].length<3){
		    	strDatosTD  =new String[1][4];
		    	strDatosTD[0][0]="";
		    	strDatosTD[0][1]="";
		    	strDatosTD[0][2]="";
		    	strDatosTD[0][3]="";
		    }
		    String strNombreDocto		=	strDatosTD[0][0]==null?"":strDatosTD[0][0];
		    String strClaveOP			=	strDatosTD[0][1]==null?"":strDatosTD[0][1];
		    String strAreaDocto			=	strDatosTD[0][2]==null?"":strDatosTD[0][2];
		    String strConseTD			=	strDatosTD[0][3]==null?"":strDatosTD[0][3];
		    String strAreaUsuario[][]	=	ActualizaArea.getAreaFolio(strAreaUs);
		    
		    if(strAreaUsuario == null){
		    	strAreaUsuario = new String[1][1];
		    	strAreaUsuario[0][0]="";
		    }
		    String strNombreArea		=	strAreaUsuario[0][0];
				
		    //* strDatosFolio almacena los datos de un folio
		    bExisteFol = ActualizaFolio.ExisteFolio(strAreaUs);
		    if(bExisteFol){
		        String strDatosFolio[][]	=	ActualizaFolio.getGeneracionFolio(strAreaUs);
		        
		        if(strDatosFolio==null){
			    	strDatosFolio  =new String[1][5];
			    	strDatosFolio[0][0]="";
			    	strDatosFolio[0][1]="";
			    	strDatosFolio[0][2]="";
			    	strDatosFolio[0][3]="";
			    	strDatosFolio[0][4]="";
			    }
		        
		        claveFolio			=	strDatosFolio[0][0];
		        consecutivo			=	strDatosFolio[0][1];
		        tipoDocto			=	strDatosFolio[0][2];
		        orden				=	strDatosFolio[0][3];//0=SI, 1=NO
		        idFolio				=	strDatosFolio[0][4];
		        int iConsecutivo 	= 	0;
		        
		        if(strConfFolio.equals("1")){
		            strFolioGenerado = GeneracionFolio.setGeneracionFolios(	strClaveOP, claveFolio, 
																			strConseTD, orden);
		            iConsecutivo = new Integer(strConseTD).intValue();
		        }else{
		            strFolioGenerado = GeneracionFolio.setGeneracionFolios(	strClaveOP, claveFolio, 
																		consecutivo, orden);
		            iConsecutivo = new Integer(consecutivo).intValue();
		        }
		        
		        int a = iConsecutivo + 1;
		        
		        if(strConfFolio.equals("1")){
		            bUpdateConse 	=	ActualizaTipo_Doc.ActualizaConsecutivoFolio(a, strIdTipoDocto);
		        }else{
		            bUpdateConse	=	ActualizaFolio.ActualizaConsecutivoFolio(a, idFolio);
		        }
		    }
		    else{
		        strFolioGenerado = GeneracionFolio.setGeneracionSinFolio(strNombreArea);
		    }//** Fin de la generacion del folio
		}else{
		    ////System.err.println("No genera ningun folio");
		    strFolioGenerado = "folio por asignar";
		}//fin strIdTipoDocto != null && strIdTipoDocto.length() > 0
		
		//** Se insertan los datos en la tabla de SD_ASUNTO 
		String stridUltimoId	=	ActualizaAsunto.InsertarAsunto(	strIdEntidad, strIdRemitente,
												strFirmante, strAsunto,
												strIdExpediente, /*strUbicacion,
												strReferenciaExp,*/ strIdTipoDocto,
												/*strCategoriaDocto,*/ strFechaRecepcion, strFechaDocto,
												strFechaCaducidad, strFolioExterno, strFolioIntermedio,
												strSintesis, strComentarios, strPalabraClave,
												strAsuntoAnterior, strIdPrioridad, strFolioGenerado,
												strIdUsrCaptura, strFechaCreacion, strAreaUs, 
												strIdTipoAsunto, strIdDestinatario, strControl, strEstatus,"","","","","","","","","","", "", "");
		//** Fin Insertar Asunto
		//String stridUltimoId = ActualizaAsunto.getUltimoIdAsunto();
		//** Se registra en la bitacora quien ha creado el nuevo asunto
		bInsertarBit	=	ActualizaBitacora.InsertarEventoAltaAsunto(strIdUsrCaptura, strFolioGenerado);
		if(!strIdRuta.equals("null")){
			////System.out.println("**ruta automatica**");
			String strDetalleRuta[][] = ActualizaFlujo.getDetalleRuta(strIdRuta);
			ActualizaInstrucciones.insertarInstruccion(strDetalleRuta, stridUltimoId);
			
		}//** Fin registro bitacora
		
		//** Se envia un mail al Destinatario o usuario que tiene como rol de turnador
		//** para que atienda el nuevo asunto
		if(nuevoAsunto){
		        SenderMail notificar = new SenderMail(); 
		        if (ActualizaUsuario.getNotificacionMail(strIdDestinatario)){
			        notificar.sendNotificarNuevoAsunto(strDestinatario, strMailDest, strRemitente, strCorreo, 
            				strAsunto,SN, stridUltimoId,strRutaBase,request.getSession().getServletContext());
		        }
		}
		
		return stridUltimoId;
	}
	
	public void ActualizarAsunto(String strIdEntidad, String strIdRemitente,
								String strFirmante, String strAsunto,
								String strIdExpediente,String strUbicacion,
								String strReferenciaExp, String strIdTipoDocto,
								String strCategoriaDocto, String strFechaRecepcion, String strFechaDocto,
								String strFechaCaducidad, String strFolioExterno, String strFolioIntermedio,
								String strSintesis, String strComentarios, String strPalabraClave,
								String strAsuntoAnterior, String strIdPrioridad, String strIdTipoAsunto,
								String strIdAsunto, String strIdUsrCaptura, int numero,
								String strEstatus, String strFolioRep)
	{
	    boolean bUpdate 		= 	false;
	    boolean bInsertarBit	=	false;
	    
	    
	    bUpdate  =	ActualizaAsunto.ActualizarAsuntos(	strIdEntidad, strIdRemitente,
	            										strFirmante, strAsunto, 
														strIdExpediente, /*strUbicacion, 
														strReferenciaExp,*/ strIdTipoDocto, 
														/*strCategoriaDocto,*/ strFechaRecepcion, strFechaDocto, 
														strFechaCaducidad, strFolioExterno, strFolioIntermedio, 
														strSintesis, strComentarios, strPalabraClave, 
														strAsuntoAnterior, strIdPrioridad, strIdTipoAsunto, 
														strIdAsunto, numero, strEstatus, strFolioRep,
														"","","","","","","","","","","", "", "", "");
	    
	    bInsertarBit	=	ActualizaBitacora.InsertarEventoCambioAsunto(strIdUsrCaptura, strFolioRep);
	}
}

